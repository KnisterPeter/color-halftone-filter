<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Halftone screen filter</title>
<style>
body {
	margin: 0px;
	font-family:Helvetica, Arial, sans-serif;
	font-size:12px;
}

#container {
	position: relative;
	background-color:#e3ddd8;
}

#canvas {
	position:absolute;
	top:10px;
	left:10px;
}
</style>
<script src="js/tsunami/utils/Debug.js"></script>
<script src="js/tsunami/geom/Rectangle.js"></script>
<script src="js/tsunami/geom/Point.js"></script>
<script src="js/tsunami/geom/Ratio.js"></script>
<script src="js/tsunami/filters/Blendmode.js"></script>
<script src="js/tsunami/filters/ColorHalftoneFilter.js"></script>
<script>

  init = function () {
    container = document.getElementById("container");
    this.regularBorder();

    canvas = document.getElementById("canvas");
    copy = document.createElement("canvas");

    filter = new tsunami.filters.ColorHalftoneFilter();

    image = new Image();
    image.onload = this.imageload.bind(this);
    image.src = '520297143_295x166.jpg';
  }
	

	regularBorder = function () {
		container.style.backgroundColor = "#e3ddd8";
	}

	imageload = function (event) {
		var size = tsunami.geom.Ratio.scaleToFill({width:image.width, height:image.height}, {width:canvas.width, height:canvas.height});
		var size2 = tsunami.geom.Ratio.scaleToFit({width:canvas.width, height:canvas.height}, {width:image.width, height:image.height});

		var context = copy.getContext("2d");
		context.drawImage(image, (image.width - size2.width) / 2, (image.height - size2.height) / 2, size2.width, size2.height, 0, 0, canvas.width, canvas.height);

		this.applyFilter();
	}

	applyFilter = function() {
		var context = canvas.getContext("2d");
		context.drawImage(copy, 0, 0, canvas.width, canvas.height);
		setTimeout(this.waitForRedraw.bind(this), 100);
	}

	waitForRedraw = function() {
		var context = canvas.getContext("2d");
		// filter.pixelsPerPoint = eval(range.value);
		filter.pixelsPerPoint = 6;
		filter.applyFilter(context);
    filter.grayscale(context);
	}

</script>
</head>
<body onload="init()">
<div id="container">
	<canvas id="canvas"></canvas>
</div>
</body>
</html>
